################################################################################
Шаблонизатор для страниц и приложений
################################################################################

********************************************************************************
Функции для шаблонов страниц и приложений
********************************************************************************

тест При создании шаблонов для страниц и написании приложений используется подобие языка, которое дает возможность формировать нужную нам HTML страницу.
Сами шаблоны могут состоять из вызовов двух типов 
FuncName() и FuncName{}. В обих случаях производится вызов GO-функции, только в первом случае параметры передаются как массив строк, а во втором как ассоцированный массив с парами ключ значение. Параметры можно не заключать в кавычки. Если параметр содержит запятую или закрывающуюу скобку, то можно заключить его в двойные кавычки или обратные ``. Если функция не имеет параметров или только один параметр , то вместо круглых скобок можно ставить двоеточие. *MyFunc:param* эквивалентно *MyFunc(param)*.


Например,

.. code:: js

      FuncName( строка 1, строка 2, “Третья строка, с запятой”)

.. code:: js

      FuncName{ string1: строка 1, string2: строка 2, string3: “Третья строка, с запятой” }

.. note::

      Функции в будущем могут дополняться новыми параметрами.

********************************************************************************
Описание функций
********************************************************************************

**And(param, [param,...])** - Осуществляет логическую операцию И со всеми указанными параметрами. Значение параметра считается ложью, если он равен пустой строке, 0 или false. Во всех остальных случаях значение параметра считается истинной.

**Address([wallet_id])** - возвращает адрес кошелька в виде 1234-5678-...-7990. wallet_id должен быть числом. Если он не указан, то будет возвращаться адрес текущего гражданина (пользователя).


**AppNav(appname, [text])** - возвращает ссылку на указанное приложение. Если text не указан, то текст ссылки будет такой же как appname.

**Back(type, page, [params]  )** - Заносит вызов указанной страницы в историю вызовов. type - может быть page или template. page - имя страниц. В params можно указать параметры вызова указанной страницы.

**BlockInfo( blockid )** - выводит ссылку с номером указанного блока, по которой будет открываться окно с информацией о данном блоке.

**BtnEdit( page, id )** - создает кнопку с шестеренкой с ссылкой на указанную страницу page и передает туда id в качестве параметра. Может применяться в таблицах для ссылки на редактирования элементов.

**BtnTemplate(template,text,[params],[class], [anchor])** - создает ссылку на шаблон в виде кнопки load_template('template’, {params} ), где text - текст ссылки. params не является обязательным параметром.  Четвертым параметром можно указать классы для кнопки, а пятым якорь для перехода по странице после загрузки содержимого.

**BtnSys(pagename,text,[params],[class])** - создает ссылку на предопределенную страницу в виде кнопки load_page('mypage’, {params}), где text - текст ссылки. params не является обязательным параметром.  Четвертым параметром можно указать классы для кнопки.

**ChartBar** - функция, которая выводит диаграмму в виде столбцов. Все параметры, за исключением *Data*, идентичны функции **ChartPie**.

**ChartPie** - функция, которая выводит круговую диаграмму. Эта функция с именованными параметрами, поэтому они указываются в фигурных скобках. 

* *Data* - вы можете указать конкретные данные для диаграммы в виже списка [[value,color,label],....]. Каждый элемент списка должен содержать три параметра - значение,цвет rrggbb и подпись. В этом случае, другие параметры будут игнорироваться.
* *Columns* - список цветов rrggbb через запятую.
* *Table* - имя таблицы, откуда будут браться данные.
* *FieldValue* - имя столбца со значениями.
* *FieldLabel* - имя столбца с подписями.

Следующие параметры являются необязательными. Они указываются по тем же правилам, что и в функции **Table**.

* *Where* - условие для выборки.
* *Order* - сортировка.
* *Limit* - смещение и количество выбираемых записей.

**CmpTime(left,right)** - сравнивает два времени в одинаковом формате. Желательно чтобы время указывалось в стандартном формате YYYY-MM-DD HH:MM:SS, можно использовать другие форматы, но последовательность должна быть от годов к секундам. Например, YYYYMMDD. Возвращает -1, если left < right, 0, если left = right или 1, если left > right.

**Date(date,[format])** - выводит date, переданную в стандартном формате 2006-01-02T15:04:05, в указанном формате. При указании формата можно использовать следующие значения - YY короткий год, YYYY полный год, MM - месяц, DD - день. Например, DD.MM.YY. Если формат не указан, то будет использоваться *dateformat* определенный в таблице languages, а если его нет, то YYYY-MM-DD.

**DateTime(datetime,[format])** - выводит дату и время, переданную в стандартном формате 2006-01-02T15:04:05, в указанном формате. При указании формата можно использовать следующие значения - YY короткий год, YYYY полный год, MM - месяц, DD - день, HH - часы, MI - минуты, SS - секунды. Например, YY/MM/DD HH:MM. Если формат не указан, то будет использоваться *timeformat* определенный в таблице languages, а если его нет, то YYYY-MM-DD HH:MI:SS.

**Div(class,text)** - создает тэг div с указанными классами и содержимым.

**Divs(class,[class,])** - создает вложенные друг в друга тэги div с указанными классами. Сколько указано параметров, столько будет создано вложенных div с указанными классами. После этого можно указывать содержимое. Для закрытия тэгов необходимо использовать функцию **DivsEnd**. 

.. code:: js

      Divs(md-5, panel) 
          P(pclass, Text)
      DivsEnd:

**Em(class,text)** - создает тэг em с указанными классами и содержимым.

**Form(class)** - Создает HTML тэг form с указанными классами. Форма будет содержать все элементы, которые указаны ниже до вызова функции **FormEnd**.

**FullScreen(state)** - Переводит ширину рабочей области страницы на всю ширину окна когда state равен 1. Когда state равен 0, то рабочая область сужается.

**GetList(name, table, colnames, [where], [order], [limit])** - получает записи из таблицы table. name - имя, по которому можно получить конкретную запись из полученного списка с помощью функции **ListVal**. colnames - список получаемых столбцов. Первым, нужно указывать колонку с индексом и потом по этому значению будет идти доступ в **ListVal**. По желанию можно указать параметр where, порядок и кол-во получаемыхз строк.

**GetOne(colname, table, where, [value])** - получает значение colname из таблицы table с условием where = value. Если параметр value не указан, то тогда параметр where должен содержать весь запрос.

**GetRow(prefix, table, colname, [value])** - получает запись из таблицы table с условием colname = value. Все столбцы записи записываются в переменные с префиксом prefix. Если параметр value не указан, то тогда параметр colname должен содержать весь запрос where.
Например, имеется id, name получим prefix_id, prefix_name. Эти переменные можно использовать в дальнейшем. Для этого достаточно указывать #prefix_id#, #prefix_name#. Вывод отсутствует. 

**If(condition, [iftrue], [iffalse])** - возвращает второй параметр, если первый параметр истина, в противном случае возвращается третий параметр. Первый параметр считается ложь, если он пустая строка, 0 или false. Если в команде **If** указан только один параметр, то тогда в случае истинности будут выполнятся вложенные функции до вызова **IfEnd**. Кроме этого, вы можете использовать внутри команды **Else** и **ElseIf**. Функции **If** могут быть вложены друг в друга. Например,

.. code:: js

      If(#value#) 
          Divs(myclass)
              If(#par#)
                 .....
              IfEnd:
          DivsEnd:
      ElseIf(#param2#)
          P(class, Text)
      Else:
          Divs(myclass2)
              .....
          DivsEnd:
      IfEnd:


**Image(src, [alt], [class] )** - возвращает тэг img с указанной картинкой. alt - необязательный параметр. Третьим параметром можно указать классы для изображения.

**Input(idname,[class],[placeholder],[type],[value] )** - создает поле ввода input. Обязательным является указание имени id идентификатора. class - классы, placeholder - текст подсказка, type по умолчанию равен *text*, но вы можете указать другой тип, например, *password*. Также, вы можете указать *value* - значение по умолчанию.

**InputAddress(idname,[class],[value] )** - создает поле ввода input для указания адреса, при этом при вводе адреса будут искаться подходящие варианты и показываться в выпадающем списке. Обязательным является указание имени id идентификатора. Пр желании можно указать классы в параметре class и адрес по умолчанию в третьем параметре.

**InputDate(idname,[class],[value] )** - создает поле ввода input для указания даты и времени. Обязательным является указание имени id идентификатора. Пр желании можно указать классы в параметре class и значение по умолчанию в третьем параметре.

**InputMoney(idname,[class],[value],[digit])** - создает поле ввода input для ввода денежных единиц. Обязательным является указание имени id идентификатора в первом параметре. Остальные параметры необязательные. class - классы, value - значение по умолчанию. В четвёртом параметре можно указать сколько цифр должно быть после десятичной точки. Если параметр *digit* не указан, то будет браться значение **money_digit** из настроек государства state_parameters.

**Json(data)** - создает тэг script с переменной jdata и указанными json данными.
Например,

.. code:: js

      Json(`param1: 1, param2: “строка”`) 
      
даст 

.. code:: js

      var jdata = { param1: 1, param2: “строка”}

**Label(text,[class])** - создает HTMl тэг **label** с указанным текстом и классами. Параметр class является необязательным. Если имеется языковой ресурс в languages с именем указанным в text, то текст тэга замениться на этот языковой ресурс.

**LangJS(resname)** - возвращет HTML тэг span с указанием данного языкового ресурса. Используется для автоматической подстановки языковых ресурсов в браузере. Здесь речь идет о ресурсах, которые описаны в static/js/lang/*.js.

**LangRes(resname)** - Ищет в таблице languages языковой ресурс с указанным именем и возвращает его.

**Legend(class, text)** - создает HTMl тэг **legend** с указанными классами и текстом. 

**LiTemplate(template, [text], [params])** - возвращает элемент li с сcылкой на указанный шаблон. Если text не указан, то текст ссылки будет такой же как template. В третьем параметре можно указать переменные для ссылки.

.. code:: js

      LiTemplate(link, mypage, global:1)


**LinkTemplate(template,text,params)** - создает ссылку на шаблон load_template('template’, {params} ), где text - текст ссылки. params не является обязательным параметром.

**ListVal(name, index, column])** - получает значение из списка полученного функцией **GetList**. name - такое же имя, какой использовалось в **GetList**. index - идентификатор поиска по первому указанному столбцу. column - имя колонки с возвращаемым значением.

**Map(coords)** - выводит карту в соответствии с переданными дянными google maps в параметре coords. Для установки высоты карт нужно определить преварительно переменную hmap. По умолчанию, высота карты составляет 100 пикселей, а ширина растягивается на максимально возможную величину.

**MapPoint(coords)** - выводит карту с маркером в соответствии с переданными дянными google maps в параметре coords. Для установки высоты карт нужно определить преварительно переменную hmap. По умолчанию, высота карты составляет 100 пикселей, а ширина растягивается на максимально возможную величину.

**MarkDown(text)** - преобразует текст с разметкой markdown в HTML. Например,

.. code:: js

      MarkDown(`## Header
            Параграф
      `)

**MenuBack(title, [page])** - Если при описании меню будет указана эта функция, то при активации страницы с данным меню, произойдет подмена верхнего пункта-ссылки на родителя. Можно сменить только текст на указанный title или также еще указать имя страницы, на которую будет осуществляться переход.

**MenuGroup(title,[idname],[icon])** - создает элемент меню с вложенным подменю. title - наименование меню, если есть такой языковой ресурс в languages, то он будет заменен. Можно указать идентификатор id и иконку. Элементы подменю должны быть определны ниже с помощью команд **MenuItem** до вызова функции **MenuEnd**. Например,

.. code:: js

      MenuGroup(My Menu,mycitizen)
            MenuItem(Interface, load_page, interface)
            MenuItem(Dahsboard, load_template, dashboard_default)
      MenuEnd:

**MenuItem(title, action, page, [params], [icon])** - создает элемент меню. title - наименование меню, если есть такой языковой ресурс в languages, то он будет заменен. action может быть page или template. page - имя загружаемой страницы. params - можно указать дополнительные параметры для вызова страницы. icon - можно указать имя иконки для данного элемента меню.

**MenuPage(name)** - Если при описании меню будет указана эта функция, то при активации страницы с данным меню, оно будет создаваться как подменю для страницы с указанным именем. То есть в верхней позиции, где указывается родительский пункт, будет стоять ссылка на  страницу-родителя.

**Money(value,[digit])** - выводит значение как денежную величину оставляя столкьо цифр после десятичной точки, сколько определено в state_parameters в переменной **money_digit**. При желании, вы можеет указать свое количество цифр после запятой, указав его во втором параметре.

**Mult(left,right)** - Умножает два числа и выводит значение округленное до целого. Параметры могут быть десятичными дробями.

**Navigation( params, …)** - возвращает панель с хлебными крошками params и ссылкой Edit справа. Например, Navigation( LiTemplate(dashboard_default, citizen),goverment)

**Now([format])** - функция возвращает текущще время в указанном формате. Если формат не указан, то тогда будет возвращатся время в виде числа секунд с 1970 года (UNIX-формат). Если в качестве формата указано *datetime*, то дата и время возвратится в виде YYYY-MM-DD HH:MI:SS. При указании формата можно использовать теже значения, что и в функции **DateTime**.

**Or(param, [param,...])** - Осуществляет логическую операцию ИЛИ со всеми указанными параметрами. Значение параметра считается ложью, если он равен пустой строке, 0 или false. Во всех остальных случаях значение параметра считается истинной.

**PageTitle(header)** - создает панель для элементов с заголовком header. В конце необходимо вставить вызов PageEnd() для закрытия div-ов.

**P(class,text)** - создает тэг p с указанным классом и содержимым.

**Param(name)** - Возвращает значение  переменной с именем **name**.

**Ring(count,[title],[size])** - Выводит кольцо со значением count посередине. При желании можно указать заголовок в title и размер кольца в параметре size.

**Select(idname, list, [class], [value])** - создает HTML тэг  **select** для выбора варинта. idname - имя id идентифкатора. Переменная list определяет список идентификаторов. Может быть два варианта определения этого списка. Можно перечислить варианты через запятую, в этом случае, значение value в option будет равно порядковому номеру с 1, а текст option соответствующему варианту. Если в languages есть языковой ресурс с таким именем, то он будет подставлен. Второй вариант - это выборка из таблиц при использовании следующего формата: **tablename.column.idname**, где tablename - имя таблицы, column - имя столбца, который будет использовать для наименований. idname - указывает имя колонки которая будет использоваться в качестве значений. Если idname не указан, то будет браться колонка с именем *id*. При втором способе существует ограничение на количество записей в таблице. Их не может быть больше 50. В параметре class можно указать классы для элемента, а в параметре value можно указать значение позиции, которая будет выбрана по умолчанию.

**SetVar( name=value,.....)** - функция присваивает значения указанным переменным. name - имя переменной, value - значение. Вывод отсутствует. Если вы не хотите, чтобы сразу подставлялись значения макросов, то используйте #= вместо =. Также, если имеются запятые в присваевоемом значении, то заключите весь параметр в обратные кавычки ``.
Например,

.. code:: js

      SetVar( var1= value1, var2 = “Значение 2”, var3=10, `var4 #= #citizen_id#, #state_id#` )
      
К переменным можно обращаться в дальнейшем как  #var1#, #var2# …

**Small(class,text)** - создает тэг small с указанными классами и содержимым.

**Source(idname,[value])** - создает поле ввода текста с подстветкой операторов, ключевых слов и т.д. Используется, например, для редактирования контрактов. idname - имя id идентификатора. При желании, можно указать значение по умолчанию во втором параметре.

**StateLink(prefix,name)** - возвращает переменную с именем prefix_name.

**StateValue(name, [index])** - возвращает значение указанного параметра из таблицы state_parameters. Предположим, что у вас в одном параметре находится список значений через запятую. например, gender = male,female и вы хотите получить какое-то одно значение. В этом случае, вы можете указать индекс этого значения (с 1) и при этом если есть языковый ресрус с такм именем, то подставится его значение. StateValue(gender, 2) возвратит Female.

**SysLink(page,text,[params])** - создает ссылку на страницу load_page(page, {params} ), где text - текст ссылки. params не является обязательным параметром.


**Table** {
    Table: tablename
    Order: id
    Where: условие
    Columns: [[Заголовок, значение],...]
} - возвращает таблицу Table - имя таблицы, Order - колонка сортировки, необязательный параметр. Where - условие выборки, необязательный параметр. Columns - массив показываемых столбцов из заголовка и значений. В качестве значений можно указывать #имяколонки#.

**Tag(tagname, [text], [class])** - создает указанный HTML тэг. На данный момент поддерживаются тэги h1-h6. text - содержимое тэга. Также можно указать дополнительные классы в третьем параметре.

**Textarea(idname,[class],[value])** - создает поле ввода textarea с id идентификатором равным idname. По желанию можно укзать классы в class и текст по умолчанию в параметре value.

**Title(text)** - создает заголовок с классом content-heading.

**TemplateNav(template,text,[param], [value])** - возвращает ссылку на шаблон load_template('template’, {param:value} ), где text - текст ссылки. param и value не являются обязательными параметрами.


**TextHidden(idname,....)** - создает скрытые textarea с id = указанным именам, а в качестве значение берется значение переменной с таким же именем. Например,
если есть переменная test = “Строка”, то TextHidden создаст textarea с id=”test” и значением Строка.

**Trim(text)** - Функция удаляет с начала и с конца пробелы и невидимые символы.

**TxButton** - функция с именованными параметрами, которая показывает кнопку Отправить, при нажатии на которую будет отправлена указанная транзакция. 

* *Contract* - имя контракта.
* *Name* - наименование кнопки. Если параметр не указан, то будет кнопка будет с текстом Send.
* *Class* - можно указать классы для div с кнопкой.
* *ClassBtn* - можно указать свои классы для кнопки.
* *OnSuccess* - можно указать страницу, куда произойдет переход в случае успешной отправки транзакции. В этом случае необходимо через запятую указать следующие параметры:  page или template,имя страницы,[дополнительные параметры].
* *Silent* - если указана 1, то пользователь не увидит сообщений об успешной отправки транзакции.
* *AutoClose* - если указана 1, то сообщение об успешной отправке закроется автоматически.
* *Inputs* - В этом параметре необходимо указать соответствие параметров контракта и значений для этих параметров. По умолчанию, значения будут браться из HTML элементов с такими же id как имена параметров в контракте. Если вы хотите брать из HTML элементов с отличающимися id, то укажите с помощью присваивания contractField1=idname1,contractField2=idname2 и т.д. Также вы можете в качестве значений указывать имена переменных. В этом случае используйте #=, contractField1#=var1,contractField2=var2. Например,

.. code:: js

      TxButton {
          Contract: MyContract,
          Inputs: 'Name=myname, Request #= myreq'
      }


**TxForm** - Функция с именованными параметрами, которая возвращает готовую форму указанного контракта.

* *Contract* - имя контракта, для которого создастся форма.
* *OnSuccess* - можно указать страницу, куда произойдет переход в случае успешной отправки транзакции. В этом случае необходимо через запятую указать следующие параметры:  page или template,имя страницы,[дополнительные параметры].
* *Silent* - если указана 1, то пользователь не увидит сообщений об успешной отправки транзакции.
* *AutoClose* - если указана 1, то сообщение об успешной отправке закроется автоматически.

.. code:: js

      TxForm {
          Contract: MyContract,
          OnSuccess: 'template,mypage'
      }


**TxId(txname)** - возвращается идентификатор указанной транзакции.

**Val(idname)** - возвращает значение HTML элемента с именем id идентификатора равным параметру idname.

**ValueById(table,idval,columns,[aliases])** - Получает запись из таблицы table с id = idval. В columns через запятую должны быть перечислены имена колонок, со значениями которых будут созданы переменные с такими же именами. Если вы хотите создавать переменные с отлиxными именами, то перечислите алиасы в том же порядке через запятую в параметре aliases.

**WhiteMobileBg(state)** - Работает аналогично фнукции **FullScreen**, но применяется на мобильных устройствах. Увеличивает ширину когда state равен 1 и сужает рабочую область когда state равен 0.

**WiAccount(address)** - выводит в специальном оформлении номер аккаунта переданном в параметре address.

**WiBalance(value, money)** - выводит в специальном оформлении денежную величину value и добавляет обозначение валюты указанной в параметре money.

**WiCitizen(name, address, [image], [flag])** - выводит в специальном оформлении информацию о гражданине. name - имя, address - номер кошелька, который в случае необходимости будет приведен к виду 1234-...-5678. Можно указать изображение и флаг страны.

